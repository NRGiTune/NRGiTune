sap.ui.define(["sap/base/Log","sap/ui/model/json/JSONModel"],function(t,e){"use strict";function a(t,e){if(t._oConsumptionChart){var a=t.getOwnerComponent().getModel("i18n").getResourceBundle();var r=e.totalConsEmpty+e.totalConsRush+e.totalConsFull;t._oConsumptionChart.data.labels=[a.getText("hdrTtlConsEmpty"),a.getText("hdrTtlConsRush"),a.getText("hdrTtlConsFull")];t._oConsumptionChart.data.datasets[0].data=[[e.totalConsEmpty/r*100],[e.totalConsRush/r*100],[e.totalConsFull/r*100]];t._oConsumptionChart.update()}}function r(t,e){const a=new Date(e);const r=t.filter(t=>{const e=new Date(t.startDate);const r=new Date(t.endDate);return a>=e&&a<=r});return r}function o(t,e){var o=t.oView.oParent.oModels.i18n.getResourceBundle();var s=e.slice(0,3).map((t,e)=>({[`hdr${e+1}`]:t[1]}));var n=e.slice(8).filter(t=>t[0]&&t[5]&&t[6]&&t[7]).map(t=>({date:t[0].split("/")[2]+"-"+t[0].split("/")[1]+"-"+t[0].split("/")[0],day:t[0].split("/")[0],readingEmpty:t[5],readingRush:t[6],readingFull:t[7]}));var l=n.sort((t,e)=>new Date(e.date)-new Date(t.date));var u=l[0].date;var i=new Date(u);var d=l[0];s.push({["hdrDateTo"]:d.date});l=n.sort((t,e)=>new Date(t.date)-new Date(e.date));var p=l[0].date;var c=new Date(p);var h=l[0];s.push({["hdrDateFrom"]:h.date});var f=l.filter(function(t){var e=new Date(t.date);return e.getDate()===1});if(c.getDate()===1){f.shift()}if(i.getDate()!==1){f.push(d)}var m=t.oView.oParent.oModels.tariffs.oData.rows;f.forEach(function(t,e,a){if(e===0){t.consEmpty=t.readingEmpty-h.readingEmpty;t.consRush=t.readingRush-h.readingRush;t.consFull=t.readingFull-h.readingFull}else{t.consEmpty=t.readingEmpty-a[e-1].readingEmpty;t.consRush=t.readingRush-a[e-1].readingRush;t.consFull=t.readingFull-a[e-1].readingFull}t.tariffs=r(m,t.date)});var y=f.reduce((t,e)=>{t.totalConsEmpty+=e.consEmpty||0;t.totalConsRush+=e.consRush||0;t.totalConsFull+=e.consFull||0;return t},{totalConsEmpty:0,totalConsRush:0,totalConsFull:0});s.push({["hdrTtlConsEmpty"]:y.totalConsEmpty});s.push({["hdrTtlConsRush"]:y.totalConsRush});s.push({["hdrTtlConsFull"]:y.totalConsFull});s.push({["hdrTtlCons"]:y.totalConsEmpty+y.totalConsRush+y.totalConsFull});a(t,y);var C=f.flatMap(t=>t.tariffs.map(e=>({...t,...e})));C.forEach(t=>delete t.tariffs);C.forEach(function(t,e,a){t.tariffSimple=(t.consEmpty+t.consRush+t.consFull)*t.priceSimple;t.tariffBiHourly=(t.consRush+t.consFull)*t.priceOutEmpty+t.consEmpty*t.priceEmpty;t.tariffTriHourly=t.consEmpty*t.priceEmpty+t.consRush*t.priceRush+t.consFull*t.priceFull});var E=C.reduce((t,e)=>{const a=e.id;if(!t[a]){t[a]={supplierName:e.name,tariff:e.description,totalSimple:0,totalBiHourly:0,totalTriHourly:0}}t[a].totalSimple+=e.tariffSimple;t[a].totalBiHourly+=e.tariffBiHourly;t[a].totalTriHourly+=e.tariffTriHourly;return t},{});var g={header:s,data:E};return g}return{parseEredesFile:function(a,r){try{var s=new Uint8Array(r);var n=XLSX.read(s,{type:"array"});var l=n.SheetNames[0];var u=n.Sheets[l];var i=XLSX.utils.sheet_to_json(u,{header:1});var d=[];switch(l){case"Leituras":d=o(a,i);break;default:}var p=new e(d);t.info("Excel carregado com sucesso");return p}catch(a){t.error("Erro ao processar Excel: "+a.message);return new e([])}}}});
//# sourceMappingURL=eRedesFileProcessor.js.map