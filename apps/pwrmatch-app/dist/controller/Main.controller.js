sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","simulador/util/fileParserEredes","sap/m/Dialog","sap/m/Button","sap/m/Title"],function(e,t,o,n,s,a){"use strict";return e.extend("simulador.controller.Main",{onInit:function(){this.getView().addEventDelegate({onAfterRendering:this._attachDrop.bind(this)})},_attachDrop:function(){if(this._dropzoneInitialized)return;this._dropzoneInitialized=true;const e=this;const t=document.getElementById("dropzone");const o=document.getElementById("fileInput");if(t&&o){t.addEventListener("dragover",function(e){e.preventDefault();t.style.borderColor="#0070f2";t.style.backgroundColor="#e6f2ff"});t.addEventListener("dragleave",function(){t.style.borderColor="#ccc";t.style.backgroundColor="transparent"});t.addEventListener("drop",function(o){o.preventDefault();t.style.borderColor="#ccc";const n=o.dataTransfer.files;e._handleFiles(n)});t.addEventListener("click",function(){o.value="";o.click()});o.onchange=function(t){e._handleFiles(t.target.files)}}},_handleFiles:function(e){if(!e||e.length===0)return;const t=e[0];if(!t.name.endsWith(".xlsx")&&!t.name.endsWith(".xls")){sap.m.MessageToast.show("Por favor selecione um ficheiro Excel (.xlsx ou .xls)");return}const n=new FileReader;n.onload=e=>{var n=this;var s=o.parseEredesFile(n,e);var a=n.getOwnerComponent().getModel("appFlowModel");a.setProperty("/consReadRows",s.consReadRows);sap.m.MessageToast.show("Ficheiro carregado: "+t.name);this.getOwnerComponent().getRouter().navTo("supplier")};n.readAsArrayBuffer(t)},onOptionReadings:function(e){var t=e.getParameter("selectedIndex");var o=t===0;this.getOwnerComponent().getModel("appFlowModel").setProperty("/optionValEFRVisible",o)},onOptionValEFRSelect:function(e){var t=e.getParameter("selectedIndex");var o=this.getOwnerComponent().getModel("i18n").getResourceBundle();var n=false;var s="";var a=0;var r="";var i=false;var l=false;var n=false;switch(t){case 1:n=true;s="sap-icon://message-warning";a=2;r=o.getText("valTypeRMsg");i=false;l=true;break;case 2:n=true;s="sap-icon://message-information";a=1;r=o.getText("valTypeCRMsg");i=true;l=false;break;case 3:n=true;s="sap-icon://message-warning";a=2;r=o.getText("valNoEFRMsg");i=false;l=false;break;default:n=false;s="";a=0;r="";i=true;l=false;break}this.getOwnerComponent().getModel("appFlowModel").setProperty("/optionValEFRMsgVisible",n);this.getOwnerComponent().getModel("appFlowModel").setProperty("/optionValEFRMsgIcon",s);this.getOwnerComponent().getModel("appFlowModel").setProperty("/optionValEFRMsgType",a);this.getOwnerComponent().getModel("appFlowModel").setProperty("/optionValEFRMsg",r);this.getOwnerComponent().getModel("appFlowModel").setProperty("/consColsVisible",i);this.getOwnerComponent().getModel("appFlowModel").setProperty("/readColsVisible",l)},onNextFromMain:function(){this.getOwnerComponent().getRouter().navTo("supplier")},onAddRow:function(){var e=this.getView().getModel("appFlowModel");var t=e.getProperty("/consReadRows");t.push({fromDate:"",toDate:"",simple:"",consEmpty:"",consFull:"",consRush:"",readEmpty:"",readFull:"",readRush:""});e.setProperty("/consReadRows",t)},onDeleteRow:function(e){const t=e.getSource().getParent();const o=t.getBindingContextPath();if(o){const e=this.getView().getModel("appFlowModel");const t=e.getProperty("/consReadRows");const n=parseInt(o.split("/")[2],10);t.splice(n,1);e.setProperty("/consReadRows",t)}},onShowEredesReadingsHelp:function(){var e=[];var t=[];var o="eRedes Readings Help";this._openEredesReadingsDialog(e,t,o)},onShowValEFRHelp:function(){var e=[];var t=[];var o="Invoice Consuption/Readings Values Help";this._openEredesReadingsDialog(e,t,o)},_openEredesReadingsDialog:function(e,t,o){var n=this;if(this._oDlg){this._oDlg.destroy();this._oDlg=null}if(!this._oDlg){this._oDlg=new sap.m.Dialog({title:o,content:[new sap.m.Text({text:"Ol√°, mundo!"})],endButton:new sap.m.Button({text:"Fechar",press:function(){this._oDlg.close()}.bind(this)})});this.getView().addDependent(this._oDlg)}this._oDlg.open()}})});
//# sourceMappingURL=Main.controller.js.map