sap.ui.define(["sap/base/Log","sap/ui/model/json/JSONModel"],function(r,e){"use strict";function a(r,e){fetch(r).then(e=>{if(!e.ok){throw new Error("Erro ao carregar ficheiro: "+r)}return e.arrayBuffer()}).then(r=>{var a=e.getOwnModels().appFlowModel;var t=a.oData.suppliersERSE;const o={target:{result:r}};var s=new Uint8Array(o.target.result);var n=XLSX.read(s,{type:"array"});var i=n.SheetNames[0];var l=n.Sheets[i];var c=XLSX.utils.sheet_to_json(l);c.forEach(function(r){if(r.COM&&r.Comercializador){var e=t.some(function(e){return e.id===r.id});if(!e){t.push({id:r.COM,name:r.Comercializador})}}})}).catch(r=>{console.error(r);sap.m.MessageToast.show("Erro ao ler ficheiro local")})}function t(r,e){fetch(r).then(e=>{if(!e.ok){throw new Error("Erro ao carregar ficheiro: "+r)}return e.arrayBuffer()}).then(r=>{var a=e.getOwnModels().appFlowModel;var t=a.oData.comConditionsERSE;const o={target:{result:r}};var s=new Uint8Array(o.target.result);var n=XLSX.read(s,{type:"array"});var i=n.SheetNames[0];var l=n.Sheets[i];var c=XLSX.utils.sheet_to_json(l);c.forEach(function(r){if(r.COM&&r.COD_Proposta){var e=t.some(function(e){return e.COM===r.COM&&e.COD_Proposta===r.COD_Proposta});if(!e){t.push(r)}}})}).catch(r=>{console.error(r);sap.m.MessageToast.show("Erro ao ler ficheiro local")})}function o(r,e){fetch(r).then(e=>{if(!e.ok){throw new Error("Erro ao carregar ficheiro: "+r)}return e.arrayBuffer()}).then(r=>{var a=e.getOwnModels().appFlowModel;var t=a.oData.comConditionsPricesERSE;const o={target:{result:r}};var s=new Uint8Array(o.target.result);var n=XLSX.read(s,{type:"array"});var i=n.SheetNames[0];var l=n.Sheets[i];var c=XLSX.utils.sheet_to_json(l);c.forEach(function(r){if(r.COM&&r.COD_Proposta){t.push(r)}})}).catch(r=>{console.error(r);sap.m.MessageToast.show("Erro ao ler ficheiro local")})}function s(r,e){fetch(r).then(e=>{if(!e.ok){throw new Error("Erro ao carregar ficheiro: "+r)}return e.arrayBuffer()}).then(r=>{var a=e.getOwnModels().appFlowModel;var t=a.oData.comConditionsPricesMetadataERSE;const o={target:{result:r}};var s=new Uint8Array(o.target.result);var n=XLSX.read(s,{type:"array"});var i=n.SheetNames[0];var l=n.Sheets[i];var c=XLSX.utils.sheet_to_json(l,{header:1});var d=c.slice(2,14).map(r=>({id:r[0],descr:r[1]}));var h=c.slice(17,83).map(r=>({id:r[0],descr:r[1]}));t.push({precosELEGN:d,condComerciais:h})}).catch(r=>{console.error(r);sap.m.MessageToast.show("Erro ao ler ficheiro local")})}function n(r,e){fetch(r).then(e=>{if(!e.ok){throw new Error("Erro ao carregar ficheiro: "+r)}return e.arrayBuffer()}).then(r=>{var a=e.getOwnModels().appFlowModel;var t=a.oData.regMrktTariffsERSE;const o={target:{result:r}};var s=new Uint8Array(o.target.result);var n=XLSX.read(s,{type:"array"});var i=n.SheetNames[0];var l=n.Sheets[i];var c=XLSX.utils.sheet_to_json(l);c.forEach(function(r){if(r.COM&&r.COD_Proposta){t.push(r)}})}).catch(r=>{console.error(r);sap.m.MessageToast.show("Erro ao ler ficheiro local")})}function i(r,e){var a=e.slice(0,3).map((r,e)=>({[`hdr${e+1}`]:r[1]}));var t=e.slice(8).filter(r=>r[0]&&r[5]&&r[6]&&r[7]).map(r=>({date:r[0].split("/")[2]+"-"+r[0].split("/")[1]+"-"+r[0].split("/")[0],day:r[0].split("/")[0],readingEmpty:r[5],readingFull:r[7],readingRush:r[6]}));var o=t.sort((r,e)=>new Date(e.date)-new Date(r.date));var s=o[0];a.push({["hdrDateTo"]:s.date});o=t.sort((r,e)=>new Date(r.date)-new Date(e.date));var n=o[0];a.push({["hdrDateFrom"]:n.date});t.forEach(function(r,e,a){if(e===0){r.toDate=a[e].date;r.readEmpty=a[e].readingEmpty;r.readFull=a[e].readingFull;r.readRush=a[e].readingRush;r.consEmpty=r.readingEmpty-n.readingEmpty;r.consFull=r.readingFull-n.readingFull;r.consRush=r.readingRush-n.readingRush}else{r.fromDate=a[e-1].date;r.toDate=a[e].date;r.readEmpty=a[e].readingEmpty;r.readFull=a[e].readingFull;r.readRush=a[e].readingRush;r.consEmpty=r.readingEmpty-a[e-1].readingEmpty;r.consFull=r.readingFull-a[e-1].readingFull;r.consRush=r.readingRush-a[e-1].readingRush;r.simple=r.consEmpty+r.consFull+r.consRush}});var i={header:a,consReadRows:t};return i}return{parseERSEFiles:function(i){try{a("data/erse/lstComercializadores.xlsx",i);t("data/erse/lstCondComerciais.xlsx",i);o("data/erse/lstPrecos_ELEGN.xlsx",i);s("data/erse/metadata.xlsx",i);n("data/erse/lstTarifas_RegM.xlsx",i);r.info("ERSE files loaded")}catch(a){r.error("Error (parseEredesFiles): "+a.message);return new e([])}}}});
//# sourceMappingURL=fileParserERSE.js.map