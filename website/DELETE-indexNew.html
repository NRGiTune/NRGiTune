<!DOCTYPE html>
<html lang="pt">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NRGiTune - Simples, Justo e Transparente</title>

    <!--
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@300;400;700&display=swap" rel="stylesheet">
    -->

    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>

<body>

    <header class="header">
        <div class="header-top">
            <a href="login.html">
                <button id="btnLogIn" class="register-button">Log In / Regista-te</button>
            </a>
            <div class="user-avatar">
                <span id="avatar" class="avatar-initials">NT</span>
            </div>
        </div>
        <div class="header-bottom">
            <div>
                <a href="#">
                    <embed type="image/svg+xml" src="imgs/logo-img.svg" width="100%" height="100%" />
                </a>
            </div>
            <nav class="nav-links">
                <a href="conta.html">Conta</a>
                <a href="termos-condicoes.html">Termos e Condições</a>
                <a href="quem-somos.html">Quem Somos</a>
            </nav>
        </div>
    </header>

    <main class="main-content">

        <p class="tagline">
            Porque escolher energia deve ser
            <span class="highlight-green">simples</span>,
            <span class="highlight-green">justo</span> e
            <span class="highlight-green">transparente</span>
        </p>

        <br />
        <h2 class="steps-title">E agora, em apenas 3 passos, já é!</h2>
        <br /><br />

        <!--
        <section class="steps-container">
            <div class="step">
                <div class="step-number">1</div>
                <div class="arrow-down"></div>
                <button class="step-button green-bg">Regista-te</button>
            </div>

            <div class="step">
                <div class="step-number">2</div>
                <div class="arrow-down"></div>
                <button class="step-button green-bg">Faz o upload dos teus consumos</button>
            </div>

            <div class="step">
                <div class="step-number">3</div>
                <div class="arrow-down"></div>
                <button class="step-button green-bg">Simula e vê quanto podes poupar</button>
            </div>
        </section>
-->
        <div class="monitor-container">
            <img src="imgs/passos.png" alt="Monitor de computador a simular os passos da NRGiTune" width="50%">
        </div>

        <div class="monitor-container">
            <img src="imgs/monitor.png" alt="Monitor de computador a simular os passos da NRGiTune" width="50%">
        </div>
        <br /><br />


        <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
        <script>
            document.addEventListener('DOMContentLoaded', function () {

                // Assegure-se de que esta configuração está correta e a biblioteca Supabase está carregada
                const SUPABASE_URL = 'https://citaewfnpsfjtnuolqyo.supabase.co';
                const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNpdGFld2ZucHNmanRudW9scXlvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc2MDcxMjMsImV4cCI6MjA3MzE4MzEyM30.JJ90UzR3_DLu6-YcWGZq623B-hXcPFBUrwg2gOLFOcI';
                const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

                // Referências aos elementos HTML
                const btnLogIn = document.getElementById('btnLogIn');
                const avatarSpan = document.getElementById('avatar');

                /**
                 * Extrai as iniciais a partir do nome completo.
                 * Ex: "João Silva Santos" -> "JS"
                 * @param {string} fullName 
                 * @returns {string} Iniciais (2 letras)
                 */
                function getInitials(fullName) {
                    if (!fullName || typeof fullName !== 'string') return 'U'; // Fallback para "User"

                    // Remove espaços duplicados e divide o nome
                    const parts = fullName.trim().split(/\s+/);

                    let initials = '';

                    if (parts.length > 0) {
                        // Pega a primeira letra do primeiro nome
                        initials += parts[0][0];

                        // Se houver mais de um nome, pega a primeira letra do último nome
                        if (parts.length > 1) {
                            initials += parts[parts.length - 1][0];
                        }
                    }

                    return initials.toUpperCase();
                }

                /**
                 * Atualiza a visibilidade dos elementos e define as iniciais do avatar.
                 * @param {object | null} user - O objeto de utilizador do Supabase.
                 */
                function updateAuthUI(user) {
                    // Verifica se os elementos HTML foram encontrados
                    if (!btnLogIn || !avatarSpan) {
                        console.error("Elementos HTML 'btnLogIn' ou 'avatar' não encontrados.");
                        return;
                    }

                    if (user) {
                        // UTILIZADOR LIGADO (LOGGED IN)
                        btnLogIn.style.display = 'none';
                        avatarSpan.style.display = 'flex';

                        // Tenta obter o nome dos metadados (assumindo 'full_name' ou 'display_name')
                        const fullName = user.user_metadata?.full_name || user.user_metadata?.display_name || user.email;

                        // Define as iniciais
                        avatarSpan.textContent = getInitials(fullName);

                    } else {
                        // UTILIZADOR DESLIGADO (LOGGED OUT)
                        btnLogIn.style.display = 'block';
                        avatarSpan.style.display = 'none';
                        avatarSpan.textContent = ''; // Limpa as iniciais
                    }
                }

                // 1. Verificar o estado atual ao carregar a página
                supabaseClient.auth.getSession().then(({ data: { session } }) => {
                    updateAuthUI(session?.user || null);
                });

                // 2. Escutar alterações no estado de autenticação (login, logout)
                supabaseClient.auth.onAuthStateChange((event, session) => {
                    // O evento 'SIGNED_IN', 'SIGNED_OUT' ou 'INITIAL_SESSION'
                    updateAuthUI(session?.user || null);
                });

                // ... o resto do seu código de login e togglePassword ...

            });
        </script>

    </main>

    <footer class="footer">
        <a href="quem-somos.html">Visão</a>
        <a href="#">Contactos</a>
        <a href="#">Parcerias</a>
    </footer>

<!-- Code injected by live-server -->
<script>
	// <![CDATA[  <-- For SVG support
	if ('WebSocket' in window) {
		(function () {
			function refreshCSS() {
				var sheets = [].slice.call(document.getElementsByTagName("link"));
				var head = document.getElementsByTagName("head")[0];
				for (var i = 0; i < sheets.length; ++i) {
					var elem = sheets[i];
					var parent = elem.parentElement || head;
					parent.removeChild(elem);
					var rel = elem.rel;
					if (elem.href && typeof rel != "string" || rel.length == 0 || rel.toLowerCase() == "stylesheet") {
						var url = elem.href.replace(/(&|\?)_cacheOverride=\d+/, '');
						elem.href = url + (url.indexOf('?') >= 0 ? '&' : '?') + '_cacheOverride=' + (new Date().valueOf());
					}
					parent.appendChild(elem);
				}
			}
			var protocol = window.location.protocol === 'http:' ? 'ws://' : 'wss://';
			var address = protocol + window.location.host + window.location.pathname + '/ws';
			var socket = new WebSocket(address);
			socket.onmessage = function (msg) {
				if (msg.data == 'reload') window.location.reload();
				else if (msg.data == 'refreshcss') refreshCSS();
			};
			if (sessionStorage && !sessionStorage.getItem('IsThisFirstTime_Log_From_LiveServer')) {
				console.log('Live reload enabled.');
				sessionStorage.setItem('IsThisFirstTime_Log_From_LiveServer', true);
			}
		})();
	}
	else {
		console.error('Upgrade your browser. This Browser is NOT supported WebSocket for Live-Reloading.');
	}
	// ]]>
</script>
</body>

</html>