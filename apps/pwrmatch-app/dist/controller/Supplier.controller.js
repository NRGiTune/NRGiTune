sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/Dialog","sap/m/Button","sap/m/Title","sap/m/Text","sap/m/OverflowToolbar","sap/m/ToolbarSpacer","sap/ui/model/json/JSONModel","simulador/model/modelsUtils"],function(e,t,i,o,s,r,a,n,l){"use strict";return e.extend("simulador.controller.supplier",{onInit:function(){var e=this.getOwnerComponent().getModel("appFlowModel");e.setProperty("/suppliers",l.getSuppliers(this));var t=new n({powers:[],tariffs:[],selectedSupplier:"ERSE",selectedTariff:null,selectedPower:null});this.getView().setModel(t);this._getSupplierTariffs("ERSE");this._getSupplierTariffPrices("6.9");var i=new n({suppliers:e.oData.suppliers});this.getView().setModel(i,"suppliers")},onSupplierChange:function(e){var t=e.getParameter("selectedItem").getKey();this._getSupplierTariffs(t)},onTariffChange:function(e){var t=e.getParameter("selectedItem").getKey();this._getSupplierTariffs(t)},_getSupplierTariffs:function(e){var t=this.getOwnerComponent().oModels.appFlowModel.oData.suppliers;var i=t.find(t=>t.id===e);var o=i?i.tariffs.map(e=>({key:e.id,text:e.descr,prices:e.prices})):[];this.getView().getModel().setProperty("/tariffs",o);if(o.length>0){var s=o[0].key;this.getView().getModel().setProperty("/selectedTariff",o[0].key)}},_getSupplierTariffPrices:function(e){var t=this.getView().getModel();var i=t.oData.selectedTariff;var o=t.oData.tariffs;var s=o.find(e=>e.key===i);var r=s?s.prices.map(e=>({key:e.Pot_Cont,text:e.Pot_Cont+" kW",cicloH:e.Contagem})):[];var a=r.filter(e=>e.cicloH===1);this.getView().getModel().setProperty("/powers",a);if(e!==null){this.getView().getModel().setProperty("/selectedPower",e)}},onShowDetails:function(){var e=this.getView().getModel();var t=e.getProperty("/selectedSupplier");var i=e.getProperty("/selectedTariff");if(!t||!i){sap.m.MessageToast.show("Escolha fornecedor e tarifário");return}var o=t;var s=this.getView().getModel("suppliers").getData().suppliers;var r=s.find(e=>e.id===o);var a=(r.tariffs||[]).find(e=>e.id===i);this._openDetailsDialog(r,a)},_openDetailsDialog:function(e,s){var r=this;if(!this._oDlg){this._oDlg=new t({title:"{/title}",content:[new sap.m.Text({text:"{/subtitle}"}),new sap.m.IconTabBar({items:[new sap.m.IconTabFilter({icon:"sap-icon://money",text:"Preços",content:new sap.m.Table({columns:[new sap.m.Column({header:new o({text:"Descrição"})}),new sap.m.Column({header:new o({text:"Valor"})})],items:{path:"/priceRows",template:new sap.m.ColumnListItem({cells:[new sap.m.Text({text:"{description}"}),new sap.m.Text({text:"{value}"})]})}})}),new sap.m.IconTabFilter({icon:"sap-icon://hint",text:"Condições",content:new sap.m.List({items:{path:"/conditions",template:new sap.m.StandardListItem({title:"{title}",description:"{desc}"})}})})]})],endButton:new i({text:"Fechar",press:function(){r._oDlg.close()}})})}var a=new n({title:e.name+" / "+s.name+" / "+this.getView().getModel().getProperty("/selectedPower"),subtitle:"Detalhes do tarifário",priceRows:[{description:"Potência",value:s.prices.power},{description:"Vazio",value:s.prices.vazio},{description:"Cheio",value:s.prices.cheio},{description:"Ponta",value:s.prices.ponta}],conditions:s.conditions||[]});this._oDlg.setModel(a);this._oDlg.open()},onBack:function(){this.getOwnerComponent().getRouter().navTo("main")},onSimulate:function(){var e=this.getOwnerComponent().getModel("viewModel");var t=this.getView().getModel().getData();this.getOwnerComponent().getRouter().navTo("step4")}})});
//# sourceMappingURL=Supplier.controller.js.map