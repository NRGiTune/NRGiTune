sap.ui.define(["sap/base/Log","sap/ui/model/json/JSONModel"],function(t,e){"use strict";function a(t,e){const a=new Date(e);const r=t.filter(t=>{const e=new Date(t.startDate);const r=new Date(t.endDate);return a>=e&&a<=r});return r}function r(t,e){var r=t.oView.oParent.oModels.i18n.getResourceBundle();var s=e.slice(0,3).map((t,e)=>({[`hdr${e+1}`]:t[1]}));var o=e.slice(8).filter(t=>t[0]&&t[5]&&t[6]&&t[7]).map(t=>({date:t[0].split("/")[2]+"-"+t[0].split("/")[1]+"-"+t[0].split("/")[0],day:t[0].split("/")[0],readingEmpty:t[5],readingRush:t[6],readingFull:t[7]}));var n=o.sort((t,e)=>new Date(e.date)-new Date(t.date));var l=n[0].date;var i=new Date(l);var u=n[0];s.push({["hdrDateTo"]:u.date});n=o.sort((t,e)=>new Date(t.date)-new Date(e.date));var d=n[0].date;var c=new Date(d);var p=n[0];s.push({["hdrDateFrom"]:p.date});var h=n.filter(function(t){var e=new Date(t.date);return e.getDate()===1});if(c.getDate()===1){h.shift()}if(i.getDate()!==1){h.push(u)}var f=t.oView.oParent.oModels.tariffs.oData.rows;h.forEach(function(t,e,r){if(e===0){t.consEmpty=t.readingEmpty-p.readingEmpty;t.consRush=t.readingRush-p.readingRush;t.consFull=t.readingFull-p.readingFull}else{t.consEmpty=t.readingEmpty-r[e-1].readingEmpty;t.consRush=t.readingRush-r[e-1].readingRush;t.consFull=t.readingFull-r[e-1].readingFull}t.tariffs=a(f,t.date)});var m=h.reduce((t,e)=>{t.totalConsEmpty+=e.consEmpty||0;t.totalConsRush+=e.consRush||0;t.totalConsFull+=e.consFull||0;return t},{totalConsEmpty:0,totalConsRush:0,totalConsFull:0});s.push({["hdrTtlConsEmpty"]:m.totalConsEmpty});s.push({["hdrTtlConsRush"]:m.totalConsRush});s.push({["hdrTtlConsFull"]:m.totalConsFull});var y=document.getElementById("chartCanvas");var E;if(E){E.destroy()}E=new Chart(y,{type:"pie",data:{labels:[r.getText("hdrTtlConsEmpty"),r.getText("hdrTtlConsRush"),r.getText("hdrTtlConsFull")],datasets:[{data:[m.totalConsEmpty,m.totalConsRush,m.totalConsFull]}]}});var v=h.flatMap(t=>t.tariffs.map(e=>({...t,...e})));v.forEach(t=>delete t.tariffs);v.forEach(function(t,e,a){t.tariffSimple=(t.consEmpty+t.consRush+t.consFull)*t.priceSimple;t.tariffBiHourly=(t.consRush+t.consFull)*t.priceOutEmpty+t.consEmpty*t.priceEmpty;t.tariffTriHourly=t.consEmpty*t.priceEmpty+t.consRush*t.priceRush+t.consFull*t.priceFull});var g=v.reduce((t,e)=>{const a=e.id;if(!t[a]){t[a]={supplierName:e.name,tariff:e.description,totalSimple:0,totalBiHourly:0,totalTriHourly:0}}t[a].totalSimple+=e.tariffSimple;t[a].totalBiHourly+=e.tariffBiHourly;t[a].totalTriHourly+=e.tariffTriHourly;return t},{});var C={header:s,data:g};return C}return{parseEredesFile:function(a,s){try{var o=new Uint8Array(s);var n=XLSX.read(o,{type:"array"});var l=n.SheetNames[0];var i=n.Sheets[l];var u=XLSX.utils.sheet_to_json(i,{header:1});var d=[];switch(l){case"Leituras":d=r(a,u);break;default:}var c=new e(d);t.info("Excel carregado com sucesso");return c}catch(a){t.error("Erro ao processar Excel: "+a.message);return new e([])}}}});
//# sourceMappingURL=eRedesFileProcessor copy.js.map