<!DOCTYPE html>
<html lang="pt-PT">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/login.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

</head>

<body>

    <main class="main-content">

        <div class="main-center">
            <a href="index.html">
                <embed type="image/svg+xml" src="imgs/logo-img.svg" width="100%" height="100%" />
            </a>
        </div>

        <div class="auth-container">

            <h1>bem vindo de volta</h1>
            <p>Entre na sua conta</p>

            <!--
            <button class="social-button">
                <i class="fab fa-github"></i>
                Continuar com o GitHub
            </button>

            <button class="social-button">
                <i class="fas fa-lock"></i>
                Continuar com SSO
            </button>

            <div class="separator">ou</div>
            -->

            <form id="form-login">
                <div class="form-group">
                    <label for="email-login">E-mail</label>
                    <input type="email" id="email-login" class="form-input" placeholder="você@exemplo.com">
                </div>

                <div class="form-group">
                    <label for="password-login">Senha</label>
                    <a href="#" class="forgot-password">Esqueceu sua senha?</a>

                    <input type="password" id="password-login" class="form-input" placeholder="••••••••" required>
                    <i class="fas fa-eye-slash password-toggle" id="togglePassword"></i>
                </div>

                <button type="submit" class="main-auth-button">
                    Entrar
                </button>
            </form>

            <div class="auth-footer-links">
                Não tem uma conta?
                <a href="registro.html">Cadastre-se agora</a>
            </div>

            <div class="policy-links">
                Ao continuar, você concorda com os
                <a href="#">Termos de Serviço</a> e a
                <a href="#">Política de Privacidade</a> da NRGiTune e em receber e-mails periódicos com atualizações.
            </div>
        </div>

        <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
        <script>
            // É crucial que a tag:
            // <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
        // esteja na sua página ANTES desta tag
        <script>

            document.addEventListener('DOMContentLoaded', function () {
                // 1. CONFIGURAÇÃO SUPABASE (Substitua pelos seus dados)
                const SUPABASE_URL = 'https://citaewfnpsfjtnuolqyo.supabase.co';
                const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNpdGFld2ZucHNmanRudW9scXlvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc2MDcxMjMsImV4cCI6MjA3MzE4MzEyM30.JJ90UzR3_DLu6-YcWGZq623B-hXcPFBUrwg2gOLFOcI';

                // Inicializa o cliente Supabase. 'supabase' deve estar globalmente disponível.
                const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

                // 2. Lógica de Login
                const form = document.getElementById('form-login');

                // Corrigindo o erro: Só adiciona o listener se o elemento for encontrado
                if (form) {
                    form.addEventListener('submit', async (e) => {
                        e.preventDefault();

                        // Mantenha os IDs dos inputs consistentes com o seu HTML. 
                        // Assumi que são 'email-login' e 'password-login' neste script
                        const email = document.getElementById('email-login').value;
                        const password = document.getElementById('password-login').value;

                        // Bloqueia o botão para evitar cliques múltiplos
                        const submitButton = form.querySelector('button[type="submit"]');
                        submitButton.disabled = true;
                        submitButton.textContent = 'A entrar...';


                        // Função de Login Supabase
                        const { data, error } = await supabaseClient.auth.signInWithPassword({
                            email: email,
                            password: password,
                        });

                        // Reativa o botão
                        submitButton.disabled = false;
                        submitButton.textContent = 'Entrar';


                        if (error) {
                            alert(`Erro ao fazer login: ${error.message}`);
                            console.error('Erro de Autenticação:', error);
                        } else if (data.user) {
                            // Redirecionar para a página da conta após o login bem-sucedido
                            window.location.href = 'conta.html';
                        }
                    });
                }

                // 3. Lógica de Visualização da Senha (Recuperada do script anterior)
                const togglePassword = document.getElementById('togglePassword');
                const passwordInput = document.getElementById('password-login'); // Use o ID correto

                if (togglePassword && passwordInput) {
                    togglePassword.addEventListener('click', function (e) {
                        // Alterna entre 'password' e 'text'
                        const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
                        passwordInput.setAttribute('type', type);

                        // Alterna o ícone
                        this.classList.toggle('fa-eye');
                        this.classList.toggle('fa-eye-slash');
                    });
                }

                // Lidar com o Esqueci Minha Senha: (Adicione a lógica de redirecionamento aqui, se necessário)

            }); // Fim do DOMContentLoaded
        </script>


    </main>

</body>

</html>