sap.ui.define(["sap/base/Log","sap/ui/model/json/JSONModel"],function(t,e){"use strict";function o(t,e){if(t._oConsumptionChart){var o=t.getOwnerComponent().getModel("i18n").getResourceBundle();var a=e.totalConsEmpty+e.totalConsFull+e.totalConsRush;var r=(e.totalConsEmpty/a*100).toFixed(1);var s=(e.totalConsFull/a*100).toFixed(1);var n=(e.totalConsRush/a*100).toFixed(1);t._oConsumptionChart.data.labels=[o.getText("hdrTtlConsEmpty"),o.getText("hdrTtlConsFull"),o.getText("hdrTtlConsRush")];t._oConsumptionChart.data.datasets[0].data=[r,s,n];t._oConsumptionChart.options={responsive:true,plugins:{datalabels:{color:"#050505",font:{weight:"bold",size:14},formatter:t=>t+"%",align:"end"},tooltip:{callbacks:{label:function(t){return t.parsed+"%"}}}}};t._oConsumptionChart.update()}}function a(t,e){const o=new Date(e);const a=t.filter(t=>{const e=new Date(t.startDate);const a=new Date(t.endDate);return o>=e&&o<=a});return a}function r(t,e){var r=t.oView.oParent.oModels.i18n.getResourceBundle();var s=e.slice(0,3).map((t,e)=>({[`hdr${e+1}`]:t[1]}));var n=e.slice(8).filter(t=>t[0]&&t[5]&&t[6]&&t[7]).map(t=>({date:t[0].split("/")[2]+"-"+t[0].split("/")[1]+"-"+t[0].split("/")[0],day:t[0].split("/")[0],readingEmpty:t[5],readingFull:t[7],readingRush:t[6]}));var l=n.sort((t,e)=>new Date(e.date)-new Date(t.date));var i=l[0].date;var u=new Date(i);var d=l[0];s.push({["hdrDateTo"]:d.date});l=n.sort((t,e)=>new Date(t.date)-new Date(e.date));var p=l[0].date;var c=new Date(p);var h=l[0];s.push({["hdrDateFrom"]:h.date});var f=l;var m=t.oView.oParent.oModels.tariffs.oData.rows;f.forEach(function(t,e,o){if(e===0){t.consEmpty=t.readingEmpty-h.readingEmpty;t.consFull=t.readingFull-h.readingFull;t.consRush=t.readingRush-h.readingRush}else{t.consEmpty=t.readingEmpty-o[e-1].readingEmpty;t.consFull=t.readingFull-o[e-1].readingFull;t.consRush=t.readingRush-o[e-1].readingRush}t.tariffs=a(m,t.date)});var g=f.reduce((t,e)=>{t.totalConsEmpty+=e.consEmpty||0;t.totalConsFull+=e.consFull||0;t.totalConsRush+=e.consRush||0;return t},{totalConsEmpty:0,totalConsRush:0,totalConsFull:0});s.push({["hdrTtlConsEmpty"]:g.totalConsEmpty});s.push({["hdrTtlConsFull"]:g.totalConsFull});s.push({["hdrTtlConsRush"]:g.totalConsRush});s.push({["hdrTtlCons"]:g.totalConsEmpty+g.totalConsFull+g.totalConsRush});o(t,g);var C=f.flatMap(t=>t.tariffs.map(e=>({...t,...e})));C.forEach(t=>delete t.tariffs);C.forEach(function(t,e,o){t.tariffSimple=(t.consEmpty+t.consRush+t.consFull)*t.priceSimple;t.tariffBiHourly=(t.consRush+t.consFull)*t.priceOutEmpty+t.consEmpty*t.priceEmpty;t.tariffTriHourly=t.consEmpty*t.priceEmpty+t.consRush*t.priceRush+t.consFull*t.priceFull});var v=Object.values(C.reduce((t,e)=>{const o=e.id;if(!t[o]){t[o]={tariffId:e.id,tariff:e.description,supplierName:e.name,totalSimple:0,totalBiHourly:0,totalTriHourly:0}}t[o].totalSimple+=e.tariffSimple;t[o].totalBiHourly+=e.tariffBiHourly;t[o].totalTriHourly+=e.tariffTriHourly;return t},{}));var y={header:s,readings:C,totals:v,enableExportToXLSXButton:true,showExportToXLSXButton:true};var E=new URLSearchParams(window.location.search);var F=E.get("debugmode");console.log("DebugMode:",F);return y}return{parseEredesFile:function(o,a){try{var s=new Uint8Array(a);var n=XLSX.read(s,{type:"array"});var l=n.SheetNames[0];var i=n.Sheets[l];var u=XLSX.utils.sheet_to_json(i,{header:1});var d=[];switch(l){case"Leituras":d=r(o,u);break;default:}var p=new e(d);t.info("Excel carregado com sucesso");return p}catch(o){t.error("Erro ao processar Excel: "+o.message);return new e([])}},exportToXLSX:function(t,e="NRGiTune-Detalhes.xlsx"){var o=t.readings;var a=t.totals;if(!o||!o.length||!a||!a.length){console.warn("Modelos: Leituras e Totais vazio, nada para exportar.");return}const r=XLSX.utils.json_to_sheet(o);const s=XLSX.utils.json_to_sheet(a);const n=XLSX.utils.book_new();XLSX.utils.book_append_sheet(n,r,"Leituras");XLSX.utils.book_append_sheet(n,s,"Totais");XLSX.writeFile(n,e)}}});
//# sourceMappingURL=eRedesFileProcessor.js.map